!function(e,n){location.protocol,location.host;var s=new Function,r=1,c=[],o=[],t="",l="",u="",p="",i=aspenLib.getQueryString("brandId")||"",v=aspenLib.getQueryString("couponValue")||"";keyWord=aspenLib.getQueryString("keyword")||"",activeWord="",activeLink="",activeType="",Array.prototype.delRepeat=function(){if(this.constructor===Array){for(var e={},n=[],s=0,r=this.length;s<r;s++)e[this[s]]||(e[this[s]]=1,n.push(this[s]));return n}},s.fn=s.prototype={constructor:s,init:function(){_this=this,_this.bindEvent(),_this.filterInformation(),_this.changeSearchInpt(),_this.searchDefault()},searchDefault:function(){var e=this,n=document.querySelectorAll(".search-input")[0];aspenLib.ajax({url:aspenLib.ajaxUrl+"/searchProductDefaultH5.do",type:"post",dataType:"json",headers:{},data:{},success:function(s){s&&"1"==s.result&&(e.activeWord=s.data.actActiveEntranceList[0].activeWord,e.activeLink=s.data.actActiveEntranceList[0].activeLink,e.activeType=s.data.actActiveEntranceList[0].activeType,n.placeholder=s.data.actActiveEntranceList[0].activeWord)},error:function(e){console.log(e)}})},hotSearch:function(e){var n=document.getElementById("searchHot"),s="";aspenLib.ajax({url:aspenLib.ajaxUrl+"/searchProductHotJsonTaiJi.do",type:"post",dataType:"json",headers:{},data:{deviceType:2},success:function(r){if(r&&"1"==r.result){var c=r.data.actActiveEntranceList;"string"==typeof r.data&&(c=JSON.parse(r.data.actActiveEntranceList));for(var o=0;o<c.length;o++)o<10&&(s+="<a data-index="+o+' href="javascript:;" data-href="'+(c[o].activeLink?c[o].activeLink:"")+'" data-jump="'+c[o].activeJump+'" data-type="'+c[o].activeType+'">'+c[o].activeWord+(c[o].activePic?'<img src="'+c[o].activePic+'">':"")+"</a>");n.innerHTML=s,e()}},error:function(e){aspenLib.tips(e)}})},filterInformation:function(){var n=this,s=(document,document.querySelectorAll("body")[0]),y=document.querySelectorAll("#sortTabBar em"),f=document.querySelectorAll(".class-pop-main")[0],L=document.querySelectorAll(".class-pop-content"),m=document.querySelectorAll(".search-input")[0];if(y)for(var g=0;g<y.length;g++)y[g].index=g,y[g].addEventListener("click",function(){var e=this;e.index;function s(e,n){2===(e=e||0)&&(y[1].classList.remove("actives"),y[1].classList.remove("cur")),1===e&&(y[2].classList.remove("actives"),y[2].classList.remove("cur")),"function"==typeof n&&n.call(this)}if("2"==e.getAttribute("data-type"))u="",s(1,function(){e.classList.toggle("actives"),/actives/.test(e.className)?(p="0",e.classList.remove("cur")):(p="1",e.classList.add("cur"))}),(v=document.getElementById("searchList"))&&(v.innerHTML=""),n.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:m.value.replace(/(^\s+)|(\s+$)/g,"")||null,size:20,page:r,sortSales:p,sortPrice:u,productType:l});else if("3"==e.getAttribute("data-type")){var v;p="",s(2,function(){e.classList.toggle("actives"),/actives/.test(e.className)?(u="1",e.classList.remove("cur")):(u="2",e.classList.add("cur"))}),(v=document.getElementById("searchList"))&&(v.innerHTML=""),n.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:m.value.replace(/(^\s+)|(\s+$)/g,"")||null,size:20,page:r,sortSales:p,sortPrice:u,productType:l})}else if("4"==e.getAttribute("data-type"))s(3,function(){var e=document.querySelectorAll(".screen-wraps")[0];e.style.display="block",e&&e.classList.add("animate")});else if(f&&L){for(var g=e.getAttribute("data-type"),b=0;b<L.length;b++)L[b].style.display="none";switch(g){case"1":L[0].style.display="block";break;case"3":L[2].style.display="block"}s(0,function(){e.classList.toggle("actives"),/actives/.test(e.className)?(e.classList.remove("cur"),f.classList.add("add-show")):(e.classList.add("cur"),f.classList.remove("add-show"))})}},!1);s.addEventListener("click",function(s){var f=(s=s||e.event).target||s.srcElement;if(/pro-sub-class/.test(f.className))if(/actives/.test(f.className)){var g=document.querySelectorAll(".ssortc-main em");if(g.length>0){for(var b=0,k=g.length;b<k;b++)c.push(g[b].getAttribute("data-id"));c=c.delRepeat()}f.classList.remove("actives")}else f.classList.add("actives");if(/class-pop-main/.test(f.className)){f.classList.remove("add-show");for(b=0;b<y.length;b++)y[b].classList.remove("actives")}var h=L[0].querySelectorAll("em"),S=L[1].querySelectorAll("em"),w=document.querySelectorAll(".ssortc-inpt")[0],A=document.querySelectorAll(".ssortc-inpt")[1],q=document.querySelectorAll(".ssortc-inpt");switch(f.className){case"ssort-reset":for(var E=0;E<h.length;E++)h[E].classList.remove("actives");for(var F=0;F<S.length;F++)S[F].classList.remove("actives");for(var d=0;d<q.length;d++)q[d].value="";c=[];break;case"ssort-confirm":t="*_*",document.getElementById("loadStart").innerHTML="点击加载更多",document.getElementById("loadStart").classList.remove("no-more-data");for(F=0;F<h.length;F++)/actives/.test(h[F].className)&&c.push(h[F].getAttribute("data-id"));c=c.delRepeat();for(F=0;F<S.length;F++)/actives/.test(S[F].className)&&o.push(S[F].getAttribute("data-id"));o=o.delRepeat(),t=""!=w.value&&""!=A.value?w.value+"_"+A.value:""!=w.value&&""==A.value?w.value+"_*":""==w.value&&""!=A.value?"*_"+A.value:v?v+"_*":"",r=1,document.getElementById("searchList").innerHTML="",n.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:m.value.replace(/(^\s+)|(\s+$)/g,"")||null,size:20,page:r,sortSales:p,sortPrice:u,productType:l})}},!1)},brandFilter:function(e){var n=document.querySelectorAll(".class-pop-content");aspenLib.ajax({url:aspenLib.ajaxUrl+"/productSearch/searchBrandJsonVH",type:"GET",dataType:"json",headers:{},data:{keyword:document.querySelectorAll(".search-input")[0].value||null,size:100,start:1},success:function(e){if(e&&"1"==e.result){var s=e.data;if(s.length<1)return;var r="";r+='<div class="search-filter-wrap clearfix"><h3 class="ssort-title"><em>品牌</em></h3><div class="ssortc-main clearfix">';for(var c=0;c<s.length;c++)r+='<em class="pro-sub-class" data-id="'+s[c].id+'">'+s[c].name+"</em>";r+="</div></div>",n[0].innerHTML=r,r=null}else aspenLib.tips(e.msg)},error:function(e){aspenLib.tips(e)}})},classFilter:function(e){var n=document.querySelectorAll(".class-pop-content"),s=document.getElementById("loadSclassList");aspenLib.ajax({url:aspenLib.ajaxUrl+"/productSearch/searchCateJsonVH",type:"GET",dataType:"json",headers:{},data:{keyword:document.querySelectorAll(".search-input")[0].value||null,size:100,start:1},success:function(e){if(e&&"1"==e.result){var r=e.data;if(r.length>0){var c="",t="";c+='<div class="search-filter-wrap clearfix"><h3 class="ssort-title"><em>分类</em></h3><div class="ssortc-main clearfix">';for(var l=0;l<r.length;l++)if(c+='<em class="pro-sub-class" data-id="'+r[l].id+'">'+r[l].name+"</em>",o.length>0)for(var u=0,p=o.length;u<p;u++)o[u]==r[l].id?t+='<b class="curs" data-id="'+r[l].id+'">'+r[l].name+"</b>":t+='<b data-id="'+r[l].id+'">'+r[l].name+"</b>";c+="</div></div>",n[1].innerHTML=c,s&&(s.innerHTML=t),c=null,t=null}}else aspenLib.tips(e.msg)},error:function(e){aspenLib.tips(e)}})},priceFilter:function(){var e="";e+='<div class="search-filter-wrap clearfix"><h3 class="ssort-title"><em>价格区间</em></h3><div class="ssortc-main tc clearfix"><span><input class="ssortc-inpt" type="number" maxlength="6" minlength="1" value="" placeholder="最低价" /></span><span>——</span><span><input class="ssortc-inpt" type="number" maxlength="6" minlength="1" value="" placeholder="最高价" /></span></div></div>',document.querySelectorAll(".class-pop-content")[2].innerHTML=e,e=null},searchList:function(e,n){var s=document.querySelectorAll(".search-recom")[0],c=document.querySelectorAll(".search-result")[0],o=document.getElementById("searchList"),t=document.getElementById("loadStart"),l="",u=document.querySelectorAll("#sortTabBar em");t&&(t.innerHTML="点击加载更多"),t&&t.classList.remove("no-more-data"),aspenLib.ajax({url:aspenLib.ajaxUrl+"/productSearch/searchProductJsonVH",type:"post",dataType:"json",headers:{},data:{brand:e.brand||"",cate:e.cate||"",keyword:e.keyword||"",priceTag:e.priceTag||"",size:e.size||20,page:e.page||r,sortSales:e.sortSales||"",sortPrice:e.sortPrice||"",productType:e.productType||""},success:function(e){if(s.style.display="none",c.style.display="block",e&&"1"==e.result){if(e.data&&e.data.length>0){e.data.length<10&&(t&&(t.innerHTML="- 人家是有底线的 -"),t&&t.classList.add("no-more-data"));for(var r=0;r<e.data.length;r++){var p="";e.data[r].tagFall&&e.data[r].marketPrice&&(p=1==e.data[r].priceType?e.data[r].spuPrice&&e.data[r].marketPrice-e.data[r].spuPrice>0?'<i class="zj">直降<br><b>'+(e.data[r].marketPrice-e.data[r].spuPrice)+"</b></i>":"":1==localStorage.getItem("member")&&e.data[r].spuPrice>0?e.data[r].marketPrice-e.data[r].spuPrice>0?'<i class="zj">直降<br><b>'+(e.data[r].marketPrice-e.data[r].spuPrice)+"</b></i>":"":e.data[r].marketPrice-e.data[r].malMobilePrice>0?'<i class="zj">直降<br><b>'+(e.data[r].marketPrice-e.data[r].malMobilePrice)+"</b></i>":"");var i=e.data[r].tagFree?'<i class="mx">'+e.data[r].tagFree+"</i>":"";l+='<li><a href="detail.html?productId='+e.data[r].id+'"><span class="product-pic"><img src="'+e.data[r].masterImg+'"><span class="product-tag">'+p+i+"</span>",e.data[r].productStock<1&&(l+="<em>已售罄</em>"),l+='</span><span class="product-right">',"1"==e.data[r].isSelf?l+='<h3 class="product-tit"><span class="product-self">自营</span> '+e.data[r].name1+"</h3>":l+='<h3 class="product-tit">'+e.data[r].name1+"</h3>",1==e.data[r].priceType?l+='<span class="product-first"><i class="i-first"></i> 优先购</span><span class="product-price vip">¥'+e.data[r].spuPrice+' <i class="t-vip"></i></span>':l+='<span class="product-price">¥'+e.data[r].malMobilePrice.toFixed(2)+(1==e.data[r].isActShow&&1==e.data[r].isActShow?'<span class="act-price'+(e.data[r].spuPrice/1?" mr0":"")+'">活动价</span>':"")+(e.data[r].spuPrice/1?'<span class="product-price-vip">¥'+e.data[r].spuPrice+'</span> <i class="t-vip"></i>':(e.data[r].marketPrice&&e.data[r].marketPrice-e.data[r].malMobilePrice>0?' <span class="del">¥'+e.data[r].marketPrice+"</span>":"")+"</span>"),l+='<span class="product-monpay">月供：¥'+e.data[r].productPaymentMinInstallment+"起</span></span></a></li>"}}else t&&(t.innerHTML="- 人家是有底线的 -"),t&&t.classList.add("no-more-data");if(/add-show/.test(document.querySelectorAll(".class-pop-main")[0].className)){document.querySelectorAll(".class-pop-main")[0].classList.remove("add-show");for(var v=0;v<u.length;v++)u[v].classList.remove("actives")}"function"==typeof n&&n.call(this),localStorage.getItem("loginState")}else aspenLib.tips(e.msg);o.innerHTML+=l},error:function(e){console.log(e)}})},changeSearchInpt:function(){var e=this,n=document.querySelectorAll(".search-input")[0],s=!0,v=document.getElementById("searchTipsList"),y="";v&&(e.searchVagueAjax=function(e,n){aspenLib.ajax({url:aspenLib.ajaxUrl+"/productSearch/searchVoguePPLJsonVH",type:"post",dataType:"json",data:{keyword:e.keyword},success:function(e){if(e&&"1"==e.result){var n=0;for(var s in e.data){if(y+='<li><span class="s-main-key" data-index='+n+">"+s+'</span><span class="s-sub-class">',e.data[s].length>0)for(var r=0,c=e.data[s].length;r<c;r++)y+="<em data-index="+n+' data-key="'+s+'" class="s-pro-key" data-sid="'+e.data[s][r].id+'">'+e.data[s][r].name+"</em>";y+="</span></li>",v.innerHTML=y,n++}}else aspenLib.tips(e.msg)},error:function(e){console.log(e)}})},n&&n.addEventListener("input",function(){if(""!=this.value){if(s){s=!1;""!=this.value&&(y="",e.searchVagueAjax({keyword:this.value})),setTimeout(function(){s=!0},500)}}else y="",v.innerHTML=""},!1),v.addEventListener("click",function(s){var y=(s=s||window.event).target||s.srcElement;try{sensors.track("SearchRequest",{platform_type:"H5",keyWords:y.getAttribute("data-key"),keywordSource:4,isLogin:1==localStorage.getItem("loginState"),clickPosition:y.dataset.index})}catch(e){}"s-pro-key"==y.className&&(c=[],o=[],t="",l="",u="",p="",n.value=y.getAttribute("data-key")+y.innerHTML,o.push(y.getAttribute("data-sid")||""),e.brandFilter(s.target.innerHTML),e.classFilter(s.target.innerHTML),e.priceFilter(),e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:y.getAttribute("data-key"),size:20,page:r,sortSales:p,sortPrice:u,productType:l},function(){v.innerHTML=""})),"s-main-key"==y.className&&(c=[],o=[],t="",l="",u="",p="",n.value=y.innerHTML,e.brandFilter(s.target.innerHTML),e.classFilter(s.target.innerHTML),e.priceFilter(),e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:y.innerHTML,size:20,page:r,sortSales:p,sortPrice:u,productType:l},function(){v.innerHTML=""}))},!1))},bindEvent:function(){var e=this,n=document.querySelectorAll(".search-confirm")[0],s=document.querySelectorAll(".search-input")[0],y=document.getElementById("searchHot"),f=document.querySelectorAll(".search-recom")[0],L=document.querySelectorAll(".search-result")[0],m=document.getElementById("searchList"),g=document.getElementById("searchTipsList");v?(r=1,aspenLib.tips("加载中..."),e.brandFilter(),e.classFilter(),e.priceFilter(),t=v+"_*",document.getElementById("loadStart").innerHTML="点击加载更多",document.getElementById("loadStart").classList.remove("no-more-data"),m&&(m.innerHTML=""),e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:null,size:20,page:r,sortSales:p,sortPrice:u,productType:l})):keyWord?(s.value=keyWord,r=1,e.brandFilter(keyWord),e.classFilter(keyWord),e.priceFilter(),t="*_*",document.getElementById("loadStart").innerHTML="点击加载更多",document.getElementById("loadStart").classList.remove("no-more-data"),m&&(m.innerHTML=""),e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:keyWord,size:20,page:r,sortSales:p,sortPrice:u,productType:l})):e.hotSearch(function(){y.addEventListener("touchend",function(n){if(aspenLib.parents(n.target,"a"))if(1==aspenLib.parents(n.target,"a").getAttribute("data-jump")&&aspenLib.parents(n.target,"a").getAttribute("data-href"))switch(aspenLib.parents(n.target,"a").getAttribute("data-type")/1){case 1:location.href="scene.html?scene_id="+aspenLib.parents(n.target,"a").getAttribute("data-href");break;case 2:location.href="merchant/index.html?sellerId="+aspenLib.parents(n.target,"a").getAttribute("data-href");break;case 3:location.href="detail.html?productId="+aspenLib.parents(n.target,"a").getAttribute("data-href");break;case 4:location.href=aspenLib.parents(n.target,"a").getAttribute("data-href")}else{var v=n.target.innerHTML;/<img/.test(n.target.innerHTML)&&(v=n.target.innerHTML.split("<img")[0]),s.value=v,r=1,e.brandFilter(v),e.classFilter(v),e.priceFilter(),t="*_*",document.getElementById("loadStart").innerHTML="点击加载更多",document.getElementById("loadStart").classList.remove("no-more-data"),m&&(m.innerHTML=""),sensors.track("SearchRequest",{platform_type:"H5",keyWords:v,keywordSource:2,isLogin:1==localStorage.getItem("loginState"),clickPosition:n.target.dataset.index}),e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:v,size:20,page:r,sortSales:p,sortPrice:u,productType:l})}})});var b=!0;n.addEventListener("click",function(){if(1==b){if(b=!1,""==s.value&&e.activeWord&&(s.value=e.activeWord,e.activeLink)){switch(e.activeType/1){case 1:location.href="scene.html?scene_id="+e.activeLink;break;case 2:location.href="merchant/index.html?sellerId="+e.activeLink;break;case 3:location.href="detail.html?productId="+e.activeLink;break;case 4:location.href=e.activeLink}return}if(!(""!=s.value&&s.value.length>0))return void aspenLib.tips("请添写搜索内容");g&&(g.innerHTML=""),r=1,aspenLib.tips("加载中..."),i="",e.brandFilter(),e.classFilter(),e.priceFilter(),e.searchPrice="*_*",document.getElementById("loadStart").innerHTML="点击加载更多",document.getElementById("loadStart").classList.remove("no-more-data"),m&&(m.innerHTML="");try{sensors.track("SearchRequest",{platform_type:"H5",keyWords:s.value.replace(/(^\s+)|(\s+$)/g,""),keywordSource:1,isLogin:1==localStorage.getItem("loginState"),clickPosition:-1})}catch(e){}e.searchList({brand:"",cate:"",priceTag:"",keyword:s.value.replace(/(^\s+)|(\s+$)/g,""),size:20,page:r,sortSales:"",sortPrice:"",productType:""}),setTimeout(function(){b=!0},1e3)}}),null!=aspenLib.getQueryString("searchKey")&&(1==b?(s.value=unescape(aspenLib.getQueryString("searchKey")),b=!1,r=1,aspenLib.tips("加载中..."),i="",e.brandFilter(),e.classFilter(),e.priceFilter(),t="*_*",document.getElementById("loadStart").innerHTML="点击加载更多",document.getElementById("loadStart").classList.remove("no-more-data"),m&&(m.innerHTML=""),e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:unescape(aspenLib.getQueryString("searchKey")),size:20,page:r,sortSales:p,sortPrice:u,productType:l}),setTimeout(function(){b=!0},1e3)):aspenLib.tips("请添写搜索内容")),s.addEventListener("keyup",function(){s.value.length<=0&&(f.style.display="block",L.style.display="none",m.innerHTML="")});var k=null;document.getElementById("loadStart").addEventListener("click",function(){var n=this;if(/no-more-data/.test(n.className))return!1;-1==n.className.indexOf("isload")&&(n.classList.add("isload"),r++,e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:s.value.replace(/(^\s+)|(\s+$)/g,""),size:20,page:r,sortSales:p,sortPrice:u,productType:l}),k=setTimeout(function(){n.classList.remove("isload"),clearTimeout(k)},300))},!1);var h=document.querySelectorAll(".screen-wraps")[0];h&&h.addEventListener("click",function(n){var v=this,y=(n=n||window.event).target||n.srcElement;if("em"==y.nodeName.toLowerCase()){var f=h.querySelectorAll("em");if(f){for(var L=0,g=f.length;L<g;L++)f[L].classList.remove("curs");y.classList.add("curs"),l=y.getAttribute("data-type")}}if("b"==y.nodeName.toLowerCase()&&(y.classList.toggle("curs"),/curs/.test(y.className)&&o.push(y.getAttribute("data-id")),o=o.delRepeat()),"i"==y.nodeName.toLowerCase()&&(v.style.display="none",v.classList.remove("animate")),"sFooterBtna"==y.id){var b=h.querySelectorAll("b"),k=h.querySelectorAll("em"),S=h.querySelectorAll(".ssortsa-inpt");if(b)for(var w=0,A=b.length;w<A;w++)b[w].classList.remove("curs");if(k){n=1;for(var q=k.length;n<q;n++)k[n].classList.remove("curs");k[0].classList.add("curs")}if(S)for(var E=0,F=S.length;E<F;E++)S[E].value="";t="",l="",e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:s.value.replace(/(^\s+)|(\s+$)/g,""),size:20,page:r,sortSales:p,sortPrice:u,productType:l})}if("sFooterBtnb"==y.id){getPtype=document.querySelector("#loadSproList .curs").getAttribute("data-type")||"0",classPhtml="",b=document.querySelectorAll("#loadSclassList .curs"),getSinpt=document.querySelectorAll(".ssortsa-inpt"),t="",function(e){if(b.length>0)for(var n=0,s=b.length;n<s;n++)classPhtml+=b[n].getAttribute("data-id")+",";else classPhtml="";if(getSinpt.length>0)if(""==getSinpt[0].value&&""==getSinpt[1].value)t="";else if(""==getSinpt[0].value&&getSinpt[1].value>0)t+="0_"+getSinpt[1].value;else if(getSinpt[0].value>0&&""==getSinpt[1].value)t+=getSinpt[0].value+"_*";else{if(getSinpt[0].value>getSinpt[1].value)return void aspenLib.tips("价格区间范围不正确！");t+=getSinpt[0].value+"_"+getSinpt[1].value}else t="";"function"==typeof e&&e.call(this)}(function(){m&&(m.innerHTML=""),e.searchList({brand:c.join()||i,cate:o.join()||"",priceTag:t||"",keyword:s.value.replace(/(^\s+)|(\s+$)/g,"")||"",size:20,page:r,sortSales:p,sortPrice:u,productType:l},function(){v.style.display="none",v.classList.remove("animate")})})}},!1)}},e.seacrhV2=s.fn,n.call(this,e.seacrhV2),dataMain=null}(window,function(){return seacrhV2}),document.addEventListener("DOMContentLoaded",function(){seacrhV2.init()},!1);